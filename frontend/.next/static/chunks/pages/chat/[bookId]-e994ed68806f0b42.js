(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[331],{1866:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/chat/[bookId]",function(){return s(2882)}])},7073:function(e,t,s){"use strict";var r=s(5893);s(7294),t.Z=e=>{let{children:t,variant:s="primary",size:a="md",className:n="",disabled:o=!1,type:c="button",onClick:l,...i}=e,d="".concat("btn inline-flex items-center justify-center rounded-md font-medium transition-all focus:outline-none"," ").concat({primary:"btn-primary",secondary:"btn-secondary",outline:"btn-outline"}[s]," ").concat({sm:"px-3 py-1.5 text-sm",md:"px-4 py-2",lg:"px-5 py-2.5 text-lg"}[a]," ").concat(o?"opacity-50 cursor-not-allowed":""," ").concat(n);return(0,r.jsx)("button",{type:c,className:d,disabled:o,onClick:l,...i,children:t})}},7607:function(e,t,s){"use strict";var r=s(5893);s(7294),t.Z=e=>{let{children:t,className:s="",...a}=e;return(0,r.jsx)("div",{className:"card ".concat(s),...a,children:t})}},5759:function(e,t,s){"use strict";var r=s(5893);s(7294),t.Z=e=>{let{label:t,type:s="text",id:a,name:n,value:o,onChange:c,placeholder:l,error:i,required:d=!1,className:u="",...x}=e;return(0,r.jsxs)("div",{className:"mb-4 ".concat(u),children:[t&&(0,r.jsxs)("label",{htmlFor:a,className:"label",children:[t," ",d&&(0,r.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,r.jsx)("input",{type:s,id:a,name:n,value:o,onChange:c,placeholder:l,required:d,className:"input ".concat(i?"border-red-500 focus:border-red-500 focus:ring-red-500":""),...x}),i&&(0,r.jsx)("p",{className:"error",children:i})]})}},5574:function(e,t,s){"use strict";s.d(t,{Z:function(){return i}});var r=s(5893);s(7294);var a=s(1664),n=s.n(a),o=s(1163),c=s(6266),l=()=>{let{user:e,logout:t,isAuthenticated:s}=(0,c.aC)(),a=(0,o.useRouter)();return(0,r.jsx)("nav",{className:"bg-white shadow-sm",children:(0,r.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,r.jsxs)("div",{className:"flex justify-between h-16",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(n(),{href:"/",className:"flex-shrink-0 flex items-center",children:(0,r.jsx)("span",{className:"text-xl font-bold text-primary-600",children:"BookPilot"})}),s&&(0,r.jsx)("div",{className:"hidden sm:ml-6 sm:flex sm:space-x-8",children:(0,r.jsx)(n(),{href:"/books",className:"inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium ".concat(a.pathname.startsWith("/books")?"border-primary-500 text-primary-600":"border-transparent text-secondary-500 hover:text-secondary-700 hover:border-secondary-300"),children:"My Books"})})]}),(0,r.jsx)("div",{className:"flex items-center",children:s?(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsx)("span",{className:"text-sm text-secondary-700",children:null==e?void 0:e.email}),(0,r.jsx)("button",{onClick:t,className:"text-sm text-secondary-500 hover:text-secondary-700",children:"Logout"})]}):(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsx)(n(),{href:"/auth/login",className:"text-sm text-secondary-500 hover:text-secondary-700",children:"Login"}),(0,r.jsx)(n(),{href:"/auth/register",className:"text-sm bg-primary-600 text-white px-3 py-2 rounded-md hover:bg-primary-700",children:"Register"})]})})]})})})},i=e=>{let{children:t}=e;return(0,r.jsxs)("div",{className:"min-h-screen flex flex-col",children:[(0,r.jsx)(l,{}),(0,r.jsx)("main",{className:"flex-grow container mx-auto px-4 py-8 sm:px-6 lg:px-8",children:t}),(0,r.jsx)("footer",{className:"bg-white border-t border-secondary-200 py-6",children:(0,r.jsx)("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8",children:(0,r.jsxs)("p",{className:"text-center text-sm text-secondary-500",children:["\xa9 ",new Date().getFullYear()," BookPilot. All rights reserved."]})})})]})}},6266:function(e,t,s){"use strict";s.d(t,{aC:function(){return n}}),s(5893);var r=s(7294);s(1163);let a=(0,r.createContext)({isAuthenticated:!1,user:null,login:()=>{},logout:()=>{},loading:!0}),n=()=>{let e=(0,r.useContext)(a);return void 0===e?{isAuthenticated:!1,user:null,login:()=>{},logout:()=>{},loading:!0}:e}},2882:function(e,t,s){"use strict";s.r(t);var r=s(5893),a=s(7294),n=s(1163),o=s(5574),c=s(7607),l=s(7073),i=s(5759),d=s(6266),u=s(4446);t.default=()=>{let[e,t]=(0,a.useState)([]),[s,x]=(0,a.useState)(""),[m,h]=(0,a.useState)(null),[p,f]=(0,a.useState)(!0),[g,j]=(0,a.useState)(!1),[y,v]=(0,a.useState)(""),{isAuthenticated:b}=(0,d.aC)(),N=(0,n.useRouter)(),{bookId:k}=N.query,w=(0,a.useRef)(null);(0,a.useEffect)(()=>{if(!b){N.push("/auth/login");return}k&&B()},[b,k,N]),(0,a.useEffect)(()=>{C()},[e]);let B=async()=>{try{f(!0);let[e,s]=await Promise.all([u.VB.getBook(k),u.R2.getMessages(k)]);h(e.data),t(s.data),v("")}catch(e){console.error("Error fetching chat data:",e),v("Failed to load chat. Please try again.")}finally{f(!1)}},C=()=>{var e;null===(e=w.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},Z=async e=>{if(e.preventDefault(),s.trim())try{j(!0);let e={role:"user",content:s,timestamp:new Date().toISOString()};t(t=>[...t,e]),x("");let r=await u.R2.sendMessage(k,{role:"user",content:s});t(e=>[...e,r.data])}catch(e){console.error("Error sending message:",e),v("Failed to send message. Please try again.")}finally{j(!1)}};return p?(0,r.jsx)(o.Z,{children:(0,r.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,r.jsx)("p",{className:"text-secondary-500",children:"Loading chat..."})})}):y?(0,r.jsxs)(o.Z,{children:[(0,r.jsx)("div",{className:"bg-red-50 text-red-600 p-4 rounded-md mb-6",children:y}),(0,r.jsx)(l.Z,{variant:"outline",onClick:()=>N.push("/books"),children:"Back to Books"})]}):m?(0,r.jsxs)(o.Z,{children:[(0,r.jsxs)("div",{className:"mb-6 flex justify-between items-center",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-2xl font-bold",children:"Chat with Book"}),(0,r.jsx)("p",{className:"text-secondary-600",children:m.title})]}),(0,r.jsx)(l.Z,{variant:"outline",onClick:()=>N.push("/guides/".concat(k)),children:"Back to Guide"})]}),(0,r.jsxs)(c.Z,{className:"h-[calc(100vh-240px)] flex flex-col",children:[(0,r.jsx)("div",{className:"flex-grow overflow-y-auto p-4",children:0===e.length?(0,r.jsxs)("div",{className:"h-full flex flex-col items-center justify-center text-center",children:[(0,r.jsx)("div",{className:"bg-primary-50 p-6 rounded-full mb-4",children:(0,r.jsx)("svg",{className:"w-12 h-12 text-primary-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"})})}),(0,r.jsx)("h3",{className:"text-xl font-medium text-secondary-700 mb-2",children:"Start a conversation"}),(0,r.jsx)("p",{className:"text-secondary-500 max-w-md",children:"Ask questions about the book, request clarification on concepts, or explore related topics."})]}):(0,r.jsxs)("div",{className:"space-y-4",children:[e.map((e,t)=>(0,r.jsx)("div",{className:"flex ".concat("user"===e.role?"justify-end":"justify-start"),children:(0,r.jsxs)("div",{className:"max-w-[80%] rounded-lg p-4 ".concat("user"===e.role?"bg-primary-100 text-primary-900":"bg-secondary-100 text-secondary-900"),children:[(0,r.jsx)("p",{className:"whitespace-pre-wrap",children:e.content}),(0,r.jsx)("p",{className:"text-xs mt-1 ".concat("user"===e.role?"text-primary-500":"text-secondary-500"),children:new Date(e.timestamp).toLocaleTimeString()})]})},t)),(0,r.jsx)("div",{ref:w})]})}),(0,r.jsx)("div",{className:"border-t border-secondary-200 p-4",children:(0,r.jsxs)("form",{onSubmit:Z,className:"flex space-x-2",children:[(0,r.jsx)(i.Z,{type:"text",value:s,onChange:e=>x(e.target.value),placeholder:"Type your message...",className:"mb-0 flex-grow",disabled:g}),(0,r.jsx)(l.Z,{type:"submit",variant:"primary",disabled:!s.trim()||g,children:g?"Sending...":"Send"})]})})]})]}):(0,r.jsx)(o.Z,{children:(0,r.jsxs)("div",{className:"text-center py-12",children:[(0,r.jsx)("h3",{className:"text-xl font-medium text-secondary-700 mb-2",children:"Book not found"}),(0,r.jsx)("p",{className:"text-secondary-500 mb-6",children:"The book you're looking for doesn't exist."}),(0,r.jsx)(l.Z,{variant:"outline",onClick:()=>N.push("/books"),children:"Back to Books"})]})})}},4446:function(e,t,s){"use strict";s.d(t,{Hm:function(){return l},R2:function(){return i},VB:function(){return c}});var r=s(7066),a=s(3454);let n=a.env.NEXT_PUBLIC_API_URL||"http://localhost:8000/api/v1",o=r.Z.create({baseURL:n,headers:{"Content-Type":"application/json"}});o.interceptors.request.use(e=>{let t=localStorage.getItem("token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e));let c={getBooks:()=>o.get("/books"),getBook:e=>o.get("/books/".concat(e)),uploadBook:function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=new FormData;return r.append("title",e),s&&r.append("author",s),r.append("file",t),o.post("/books",r,{headers:{"Content-Type":"multipart/form-data"}})},processBook:e=>o.post("/books/".concat(e,"/process")),deleteBook:e=>o.delete("/books/".concat(e))},l={getGuide:e=>o.get("/guides/".concat(e)),updateProgress:(e,t)=>o.patch("/guides/".concat(e,"/progress"),t),getQuiz:e=>o.get("/guides/".concat(e,"/quiz")),submitQuizResults:(e,t)=>o.post("/guides/".concat(e,"/quiz/results"),t),exportGuide:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"pdf";return o.post("/guides/".concat(e,"/export"),{format:t})}},i={getMessages:e=>o.get("/chat/".concat(e,"/messages")),sendMessage:(e,t)=>o.post("/chat/".concat(e,"/messages"),t)}}},function(e){e.O(0,[774,424,66,888,179],function(){return e(e.s=1866)}),_N_E=e.O()}]);